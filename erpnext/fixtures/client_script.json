[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Work Order",
  "enabled": 1,
  "modified": "2023-03-07 12:00:32.735648",
  "module": "Manufacturing",
  "name": "work order script",
  "script": "\nfunction success_alert(){\n\n    frappe.show_alert({\n        message:__('Stock Entries Successfully Created'),\n        indicator:'green'\n    }, 6);\n    \n}\n\nfunction process_work_orders(listview){\n    \n    let is_valid = true;\n    let selected_item_obj_list = listview.get_checked_items();\n    let selected_item_list = listview.get_checked_items(true);\n    \n    for(var k = 0; k < selected_item_obj_list.length; k++){\n        if(selected_item_obj_list[k].status === 'Draft' && is_valid === true){\n            frappe.msgprint(\"All Work Orders need to be submitted first!\");\n            is_valid = false;\n        }\n    }\n\n    if(is_valid === true){\n        frappe.xcall('erpnext.manufacturing.doctype.work_order.work_order.proceed_work_orders', {\n                \n                'selected_items': selected_item_list\n                \n        }).then(stock_entries => {\n            \n            frappe.call({\n                method: \"frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs\",\n                args: {\n                    doctype: 'Stock Entry', \n                    action: 'submit',\n                    docnames: stock_entries,\n                },\n            }).then((r) => {\n                \n                    listview.refresh();\n                    \n                    cur_list.$checks && cur_list.$checks.prop(\"checked\", false); \n                    cur_list.on_row_checked();\n                    success_alert();\n    \n    \t\t\t\tlet failed = r.message;\n    \t\t\t\tif (!failed) failed = [];\n    \n    \t\t\t\tif (failed.length && !r._server_messages) {\n    \t\t\t\t\tfrappe.throw(\n    \t\t\t\t\t\t__(\"Cannot {0} {1}\", [action, failed.map((f) => f.bold()).join(\", \")])\n    \t\t\t\t\t);\n    \t\t\t\t}\n    \t\t\t\tif (failed.length < docnames.length) {\n    \t\t\t\t\tfrappe.utils.play_sound(action);\n    \t\t\t\t\tif (done) done();\n    \t\t\t\t}\n            });\n        });\n        listview.page.remove_inner_button('Proceed');\n        cur_list.$checks && cur_list.$checks.prop(\"checked\", false); \n        cur_list.on_row_checked();\n    }\n}\n\nfunction confirm_process(listview){\n    frappe.confirm(\n        'Are you sure you want to process the orders?',\n        function(){\n            process_work_orders(listview);\n        },\n        function(){\n           window.close();\n        }\n    )\n}\n\n\nfrappe.listview_settings['Work Order'] = {\n    \n\tadd_fields: [\"bom_no\", \"status\", \"sales_order\", \"qty\",\n\t\"produced_qty\", \"expected_delivery_date\", \"planned_start_date\", \"planned_end_date\"],\n\t\n    filters: [[\"status\", \"!=\", \"Stopped\"]],\n\t\n\tget_indicator: function(doc) {\n\t\tif(doc.status===\"Submitted\") {\n\t\t\treturn [__(\"Not Started\"), \"orange\", \"status,=,Submitted\"];\n\t\t} else {\n\t\t\treturn [__(doc.status), {\n\t\t\t\t\"Draft\": \"red\",\n\t\t\t\t\"Stopped\": \"red\",\n\t\t\t\t\"Not Started\": \"red\",\n\t\t\t\t\"In Process\": \"orange\",\n\t\t\t\t\"Completed\": \"green\",\n\t\t\t\t\"Cancelled\": \"gray\"\n\t\t\t}[doc.status], \"status,=,\" + doc.status];\n\t\t}\n\t},\n\n};\n\nfrappe.listview_settings['Work Order'].onload = function(listview) {\n    \n    listview.page.add_action_item(\"Proceed\", function() {\n        confirm_process(listview);\n    });\n    \n\tlistview.$result.on('click', 'input[type=\"checkbox\"]', function(){\n\t    frappe.listview_settings['Work Order'].refresh(listview);\n\t});\n};\n\nfrappe.listview_settings['Work Order'].refresh = function(listview) {\n\t\n\tsetTimeout(() => {\n\t    \n    \tif(cur_list.$checks.length === 0){\n            listview.page.remove_inner_button('Proceed');\n    \t}\n    \t\n    \telse if(cur_list.$checks.length>0){\n    \t    listview.page.add_inner_button(__('Proceed'), function() {\n    \t        \n    \t    \tconfirm_process(listview);\n    \t    \t\n    \t    }).addClass(\"btn-primary\");\n    \t}\n\t},100);\n\t\n};",
  "view": "List"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Work Order",
  "enabled": 1,
  "modified": "2023-01-26 10:53:35.939823",
  "module": null,
  "name": "work_order_form_script",
  "script": "let is_viewed;\n\nfrappe.ui.form.on('Work Order', {\n\trefresh(frm) {\n\t\tif(is_viewed !== frm.doc.name){\n\t\t\tis_viewed = frm.doc.name;\n\t\t\tfrm.reload_doc();\n\t\t\t\t   \n\t\t}\n\t}\n})",
  "view": "Form"
 }
]